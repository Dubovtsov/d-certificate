<div class="w-2/4">
  <div class="flex justify-between items-center">
    <h1 class="font-bold text-2xl mb-3">Список отделений</h1>
    <div class="flex justify-center mb-3">
      <%= link_to new_department_path, data: { turbo_frame: 'modal' }, class: "rounded-lg btn-circle py-2 px-3 bg-green-500 text-white " do %>
        <i class="fa-solid fa-plus font-bold"></i>
      <% end %>
    </div>
  </div>

  <div class="min-w-full" data-controller="search">
    <%= form_tag departments_path, method: :get, id: "department-submit", role: 'search' do %>
      <%= text_field_tag :query, params[:query], autofocus: true, data: { 'search-target': "source", 'action': "input->search#filter" } %>
      <%= submit_tag "Искать", name: nil %>
    <% end %>

    <input data-remote='true' data-search-target="" 
              data-action="input->search#filter" 
              type="text" 
              class="search" 
              placeholder="search.." />
    <div id="departments" data-search-target="results">
      <%= render @departments %>
    </div>
  </div>

  <div class="my-5"><%== pagy_nav(@pagy) %></div>
  
  <details class="border p-3 rounded">
    <summary>import</summary>
    <div class="mb-3"> <!-- Department import -->
      <%= form_tag import_csv_departments_path, multipart: true do %>
      <div class="col input-group">
        <%= file_field_tag :file, class: "form-control" %>
      </div>
      <%= submit_tag "Импортировать", class: "btn btn-sm default-btn" %>
      <% end %>
    </div> <!-- Department import -->
  </details>
  
</div>
<h1>Kanban Board</h1>

<div class="kanban-board" data-controller="tasks">
  <div class="tasks-group" data-status="0" data-action="dragover->tasks#allowdrop drop->tasks#drop">
    <h2>Backlog</h2>
    <% @tasks.where(status: 0).each do |task| %>
      <div class="task" data-tasks-target="task" data-id="<%= task.id %>" data-status="<%= task.status %>" draggable="true" data-action="dragstart->tasks#dragstart dragend->tasks#dragend">
        <h3><%= task.name %></h3>
        <p><%= task.description %></p>
      </div>
    <% end %>
  </div>

  <div class="tasks-group" data-status="1" data-action="dragover->tasks#allowdrop drop->tasks#drop">
    <h2>In Progress</h2>
    <% @tasks.where(status: 1).each do |task| %>
      <div class="task" data-tasks-target="task" data-id="<%= task.id %>" data-status="<%= task.status %>" draggable="true" data-action="dragstart->tasks#dragstart dragend->tasks#dragend">
        <h3><%= task.name %></h3>
        <p><%= task.description %></p>
      </div>
    <% end %>
  </div>

  <div class="tasks-group" data-status="2" data-action="dragover->tasks#allowdrop drop->tasks#drop">
    <h2>Completed</h2>
    <% @tasks.where(status: 2).each do |task| %>
      <div class="task" data-tasks-target="task" data-id="<%= task.id %>" data-status="<%= task.status %>" draggable="true" data-action="dragstart->tasks#dragstart dragend->tasks#dragend">
        <h3><%= task.name %></h3>
        <p><%= task.description %></p>
      </div>
    <% end %>
  </div>
</div>